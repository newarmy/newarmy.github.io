# BFC

##  层叠上下文
1. 层叠上下文可以包含在其他层叠上下文中，并且一起创建一个层叠上下文的层级。
2. 每个层叠上下文都完全独立于它的兄弟元素：当处理层叠时只考虑子元素。
3. 每个层叠上下文都是自包含的：当一个元素的内容发生层叠后，该元素将被作为整体在父级层叠上下文中按顺序进行层叠。    
## 块格式化上下文(BFC)定义：   
块格式化上下文（Block Formatting Context，BFC） 是Web页面的可视CSS渲染的一部分，是块盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域，块格式化上下文对浮动定位（参见 float）与清除浮动（参见 clear）都很重要。浮动定位和清除浮动时只会应用于同一个BFC内的元素  
## 应用  
1. 浮动不会影响其它BFC中元素的布局，而清除浮动只能清除同一BFC中在它前面的元素的浮动  
2. 外边距折叠（Margin collapsing）也只会发生在属于同一BFC的块级元素之间  
# 视觉格式化模型  
## 定义  
CSS 视觉格式化模型（visual formatting model）是用来处理和在视觉媒体上显示文档时使用的计算规则。   

视觉格式化模型会根据CSS盒子模型将文档中的元素转换为一个个盒子  每个盒子的布局由以下因素决定：  
1. 盒子的尺寸  
2. 盒子的类型  
3. 定位方案 （普通流定位、浮动定位或绝对定位）  
4. 当前盒子的子元素或兄弟元素  
5. 视口尺寸与位置
6. 所包含的图片的尺寸 

该模型会根据盒子的包含块（containing block）的边界来渲染盒子。通常，盒子会创建一个包含其后代元素的包含块，但是盒子并不由包含块所限制，当盒子的布局跑到包含块的外面时称为溢出（overflow）。
## 盒子的生成  
盒子的生成是 CSS 视觉格式化模型的一部分，用于从文档元素生成盒子。盒子有不同的类型，不同类型的盒子的格式化方法也有所不同。盒子的类型取决于 CSS display 属性  
### 块级元素与块盒子  
当元素的 display 为 block、list-item 或 table 时，该元素将成为块级元素。一个块级元素会被格式化成一个块（例如文章的一个段落），默认按照垂直方向依次排列  
每个块级盒子都会参与块格式化上下文（block formatting context）的创建，而每个块级元素都会至少生成一个块级盒子，即主块级盒子  
一个块级盒子可能也是一个块容器盒子。块容器盒子（block container box）要么只包含其它块级盒子，要么只包含行内盒子并同时创建一个行内格式化上下文（inline formatting context）。  
1. 块级盒子： 描述了元素与其父元素和兄弟元素之间的行为  
2. 块容器盒子：描述了元素跟其后代之间的行为  
注意： 有些块级盒子并不是块容器盒子，比如表格；而有些块容器盒子也不是块级盒子，比如非替换行内块和非替换表格单元格。  
### 匿名块盒子  
在某些情况下进行视觉格式化时，需要添加一些增补性的盒子，这些盒子不能用CSS选择符选中，因此称为匿名盒子
块包含盒子可能只包含行内级盒子，也可能只包含块级盒子，但通常的文档都会同时包含两者，在这种情况下，就会在相邻的行内级盒子外创建匿名块盒子  
``` html 
<!--产生两个匿名块盒子：一个是 <p> 元素前面的那些文本（Some inline text），另一个是 <p> 元素后面的文本（followed by more inline text.） --> 
<div>Some inline text <p>followed by a paragraph</p> followed by more inline text.</div>
<!-- 两个匿名块盒子：一个是 <div> 元素前面的文本（Some inline text），另一个是其之后的文本（followed by more inline text.） -->
<p>Some <em>inline</em> text <div>followed by a paragraph</div> followed by more inline text.</p>
```  
### 行内级元素和行内盒子  
如果一个元素的 display 属性为 inline、inline-block 或 inline-table，则称该元素为行内级元素。显示时，它不会生成内容块，但是可以与其他行内级内容一起显示为多行。一个典型的例子是包含多种格式内容（如强调文本、图片等）的段落，就可以由行内级元素组成。  
在同一个行内格式化上下文中，原子行内级盒子不能拆分成多行  
替换行内级元素或 display 值为 inline-block 或 inline-table 的元素创建的盒子不会像行内盒子一样可以被拆分为多个盒子
### 匿名行内盒子  
类似于块盒子，CSS引擎有时候也会自动创建一些行内盒子。这些行内盒子无法被选择符选中，因此是匿名的，它们从父元素那里继承那些可继承的属性，其他属性保持默认值 initial。  
一种常见的情况是CSS引擎会自动为直接包含在块盒子中的文本创建一个行内格式化上下文，在这种情况下，这些文本会被一个足够大的匿名行内盒子所包含。但是如果仅包含空格则有可能不会生成匿名行内盒子，因为空格有可能会由于 white-space 的设置而被移除，从而导致最终的实际内容为空

## 行盒子  
行盒子由行内格式化上下文创建，用来显示一行文本。在块盒子内部，行盒子总是从块盒子的一边延伸到另一边（译注：即占据整个块盒子的宽度）。当有浮动元素时，行盒子会从向左浮动的元素的右边缘延伸到向右浮动的元素的左边缘。
## 定位规则
一旦生成了盒子以后，CSS引擎就需要定位它们以完成布局。下面是定位盒子时所使用的规则：

1. 普通流：按照次序依次定位每个盒子
2. 浮动：将盒子从普通流中单独拎出来，将其放到外层盒子的某一边
3. 绝对定位：按照绝对位置来定位盒子，其位置根据盒子的包含元素所建立的绝对坐标系来计算，因此绝对定位元素有可能会覆盖其他元素  

